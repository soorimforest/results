00 코드 정리: 원재료 통계량 계산

원재료 통계량 계산 및 데이터 전처리 통합 스크립트

실행 순서:
1. 각 열의 평균값 산출 (cleaned_data_preprocessed.xlsx)
2. 원재료별 평균값 계산 (원재료별_평균값.xlsx)
3. 원재료별 분산값 계산 (원재료별_분산값.xlsx)
4. 원재료별 표준편차값 계산 (원재료별_표준편차값.xlsx)
5. 원재료_3과 원재료_4의 8:2 가중 평균 계산 (원재료_3_4_가중평균_CoA.xlsx)
6. Train/Test 분할 (train_83.xlsx, test_20.xlsx)

01 코드: 특징 행렬 정리
기본 고급 특징 추출 (전구체별 통계량, 8:2 혼합 특징, BET, 입경 분포 등)
이상치 처리 후 특징 행렬에 원재료 통계량 추가 (평균, 분산, 표준편차)
가중 평균 특징 추가 (원재료_3과 원재료_4의 8:2 가중 평균)

02 코드 : 이상치 탐지 및 처리
역할: 다중 방법으로 이상치 탐지 및 전처리
주요 기능: 이상치 탐지 방법 (5가지):
IQR (Interquartile Range)
Z-score
LOF (Local Outlier Factor)
MAD (Median Absolute Deviation)
Isolation Forest
방법 선택 기준: 이상치 비율이 10%에 가장 가까운 방법 선택
허용 범위: 5% ~ 15%
처리 방식 (3가지):
제거 (remove): 이상치를 NaN으로 처리
대체 (replace): 이상치를 중앙값/평균값으로 대체
경계값 제한 (cap): 이상치를 경계값으로 제한
검증:전처리 전후 히스토그램, 박스플롯, Q-Q plot 생성, 산포 변화 시각화

03 코드 : 탐색적 데이터 분석
역할: 데이터 탐색적 분석으로 특징과 타겟 간 관계 파악
(!) 상관 분석: Pearson 상관계수로 특징(X)과 품질 지표(Y) 간 관계 계산
상관관계가 높은 특징 식별
출력: data/exploratory_analysis/correlation_analysis.csv
(2) 산포 분석: 표준편차, IQR 감소 가능성 분석
평균 대비 변동성 평가
출력: data/exploratory_analysis/dispersion_analysis.csv
(3) 시각화: 히스토그램 (분포 확인), CDF (누적 분포 함수), 박스플롯 (이상치 및 분포 확인)
출력: data/exploratory_analysis/visualizations/ (PNG 파일들)

입력: data/outlier_detection/feature_matrix_after_outliers.csv (02 코드에서 생성된 이상치 처리 후 특징 행렬)
출력: correlation_analysis.csv (상관관계 분석 결과)
dispersion_analysis.csv (산포 분석 결과)
visualizations/ (그래프들)

04 코드 : 모델 학습 (5개 모델: RF, XGBoost 기본, XGBoost 기본 튜닝, XGBoost 정밀 튜닝, H2O AutoML)


05 코드: 

# 01번
py 01_build_features.py

# 01번 완료 후 02번
py 02_detect_outliers_multiple_methods.py

# 02번 완료 후 03번
py 03_exploratory_analysis.py

# 03번 완료 후 04번
py 04_train_models.py

# 버전 1: 결측치 99% 이상 제거 + Median 보간
py 04_train_models_remove_99pct_median.py

# 버전 2: 결측치 99% 이상 제거 + Mean(산술평균) 보간
py 04_train_models_remove_99pct_mean.py

# 04번 완료 후 05번
py 05_dispersion_analysis_optimization.py

# 05번 완료 후 06번
py 06_split_train_valid_test.py

버전 1: 결측치 99% 이상 특징 제거 + Median 보간
현재 방식 유지
안정적이고 검증됨

버전 2: 결측치 99% 이상 특징 제거 + Mean 보간
Mean으로 변경하여 성능 비교
이상치가 적은 특징에서는 Mean이 더 적합할 수 있음
어떤 평균값을 사용할까요?
Mean (산술평균)
Median (중앙값) - 현재 방식
둘 다 만들어서 비교



# results 02
탐색적 분석 결과 요약
1. 산포 분석 결과
변동성이 높은 타겟 (감소 가능성 높음)
자성이물(ICP, SDI)-Fe
CV: 0.730 (73%)
IQR 비율: 0.949 (95%)
해석: 변동성이 매우 높아 추가 최적화 여지가 큼
이상치 처리 효과: 표준편차 60% 감소
자성이물(ICP, SDI)-합계
CV: 0.703 (70%)
IQR 비율: 0.959 (96%)
해석: 변동성이 매우 높음
이상치 처리 효과: 표준편차 67% 감소
자성이물(ICP, SDI)-Cr
CV: 0.340 (34%)
IQR 비율: 0.623 (62%)
해석: 변동성이 높음
이상치 처리 효과: 표준편차 85% 감소
불순물-Si
CV: 0.246 (25%)
IQR 비율: 0.344 (34%)
해석: 변동성이 높음
이상치 처리 효과: 표준편차 23% 감소
CDS 수축율
CV: 0.538 (54%)
IQR 비율: 0.789 (79%)
해석: 변동성이 매우 높음
변동성이 낮은 타겟 (이미 안정적)
조성 관련 (Li, Ni, Co, Mn, Zr): CV 0.001~0.033 (0.1~3.3%)
입도 관련 (Dmin, D10, D50, D90): CV 0.006~0.018 (0.6~1.8%)
XRD 관련: CV 0.0001~0.018 (0.01~1.8%)
해석: 이미 변동성이 낮아 추가 감소 여지가 작음. 이상치 처리로 17~35% 감소는 달성됨.
2. 상관관계 분석 결과
매우 높은 상관관계 (|r| > 0.95)
입도 관련 특징들
입도-Dmax ↔ 입도-1㎛ 이하: -0.999
입도-D10 ↔ 입도-1㎛ 이하: -0.997
해석: 입도 분포 특징 간 강한 관계
자성이물 관련 특징들
자성이물-Cr ↔ 입도-1㎛ 이하: 0.999
자성이물-합계 ↔ 입도-1㎛ 이하: 0.992
해석: 입도와 자성이물 함량 간 강한 관계
XRD 관련 특징들
XRD-Ni Occ. ↔ SPAN: 0.999
XRD-Cry.Size ↔ 조성-Ni: 0.999
해석: XRD 결과와 입도/조성 간 강한 관계
높은 상관관계 (0.8 < |r| < 0.95)
조성-Ni ↔ 잔류리튬-Li2CO3: -0.943
조성-Zr ↔ 자성이물-Cr: -0.946
입도-D10 ↔ BET-BET: 0.936
입도-D10 ↔ 불순물-Na: -0.959
XRD-Lattice a ↔ 입도-D90: -0.950
종합 해석
주요 발견
자성이물 관련 타겟
변동성이 매우 높음 (CV 34~73%)
입도와 강한 상관관계 (r > 0.99)
이상치 처리로 표준편차 60~85% 감소
결론: 추가 최적화 여지가 크고, 입도 특징이 예측에 유용
조성 관련 타겟
변동성이 낮음 (CV 0.1~3.3%)
XRD, 잔류리튬과 강한 상관관계
결론: 이미 안정적이며, XRD/잔류리튬 특징이 유용
입도 관련 타겟
변동성이 낮음 (CV 0.6~1.8%)
자성이물, BET, 불순물과 강한 상관관계
결론: 이미 안정적이며, 자성이물/BET 특징이 유용
모델 학습에 대한 시사점
추천 특징 선택 우선순위
1순위: 입도 관련 특징
상관계수가 높고 물리적 의미가 명확
자성이물, BET, 불순물과 강한 관계
2순위: 자성이물 관련 특징
변동성이 크지만 타겟과 강한 관계
입도와 밀접한 연관
3순위: XRD 관련 특징
결정 구조 정보 제공
조성, 입도와 강한 관계
4순위: 원재료 통계량 특징 (새로 추가)
원재료 변동성 정보 제공
모델 성능 향상에 기여 가능
주의사항
상관계수 0.95 이상 특징: 중복 가능성 높음 → Feature 선택 시 중복 제거 필요
샘플 수가 적은 타겟 (n < 10): 상관계수 해석 주의
결론
성공적인 부분
이상치 처리 효과: 대부분 타겟에서 표준편차 20~85% 감소
강한 상관관계 발견: 입도, 자성이물, XRD 관련 특징들이 타겟과 강한 관계
변동성 파악: 자성이물 관련 타겟의 높은 변동성 확인
개선 가능한 부분
일부 타겟 (불순물-Na): 이상치 처리 효과가 낮음
특징 선택: 상관계수 기반으로 더 엄격한 특징 선택 필요
다음 단계 권장사항
강한 상관관계 특징 우선 선택: 상위 20~30개 특징
중복 제거: 상관계수 0.90 이상 특징 제거
원재료 통계량 특징 활용: 새로 추가한 특징으로 모델 학습
---------------------------------------------------------

#04 결과

탐색적 분석 결과 해석을 정리했습니다. 주요 내용 요약:
주요 발견사항
1. 상관 분석 결과
매우 높은 상관관계 (|r| > 0.95):
입도 분포 특징들 간 강한 상관: 미세 입자 비율 ↑ → 최대 입도 ↓
XRD 결정 크기 ↔ 원재료_4의 Ni 조성: r = 0.999 (거의 완벽한 상관)
자성 불순물 ↔ 입도 분포: 미세 입자 비율 ↑ → 자성 불순물 ↑
예측 가능성이 높은 타겟:
불순물-Na: 원재료 Na, 입도, 투입량과 강한 상관 (r > 0.84)
BET 표면적: 입도 분포와 강한 상관 (r > 0.93)
XRD 결정 크기: 조성-Ni와 거의 완벽한 상관
2. 산포 분석 결과
변동성이 매우 높은 타겟 (최적화 최우선):
자성이물(ICP, SDI)-Fe: CV = 73% (변동성 매우 높음)
자성이물(ICP, SDI)-합계: CV = 70%
불순물-Si: CV = 24.6%
불순물-Na: CV = 14.8%
이미 안정적인 타겟 (추가 최적화 불필요):
조성-Li, Ni, Co, Mn: CV < 0.01 (매우 안정적)
입도 분포: CV < 0.02 (안정적)
XRD 격자 상수: CV < 0.0001 (매우 안정적)
3. 모델 학습 전략
핵심 특징 (공통 사용 권장):
입도 분포 특징 (D10, D90, Dmax, 1㎛ 이하)
원재료 조성 특징 (Ni, Mn, Co)
불순물 특징 (Na, 자성 불순물)
투입량 특징 (투입량_3_1, 투입량_4_1)
예상 성능:
높은 성능 예상: 불순물-Na, BET-BET, XRD 결정 크기
보통 성능 예상: 자성 불순물, 불순물-Si
낮은 성능 예상: 이미 안정적인 조성 타겟들

-------------------------------

TRAIN 83 TEST 20











실행 순서 (번호 순서대로)
00_calculate_material_averages_final.py - 원재료 평균값 계산
00_calculate_material_variance.py - 원재료 분산값 계산
00_calculate_material_std.py - 원재료 표준편차값 계산
01_build_features_coa_data_advanced.py - 기본 특징 추출
02_detect_outliers_multiple_methods.py - 이상치 탐지 및 전처리
01_add_material_statistics_features.py - 원재료 통계량 특징 추가
00_calculate_material_3_4_weighted_coa.py - 원재료_3과 원재료_4의 8:2 가중 평균 계산
01_add_weighted_coa_features.py - 가중 평균 특징 추가
03_exploratory_analysis.py - 탐색적 분석 (선택사항)
04_train_models_improved.py - 모델 학습


